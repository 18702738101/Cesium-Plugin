"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(){var e=Cesium.Color.fromCssColorString("#00FF00"),i=Cesium.Color.fromCssColorString("#F08519"),t=Cesium.Color.fromBytes(136,187,255,136),n=Cesium.Color.YELLOW,r=Cesium.HorizontalOrigin.LEFT,o="18px Helvetica",s=!1,a=!1,l=!1,u=!1,c=function(e){e.viewer||new Error("需要传入地球容器"),this._viewer=e.viewer,this._isMeasure=e.isMeasure||!1,this._isClampGround=e.isClampGround||!1,this._lineWidth=e.lineWidth||3,this._layer=new Cesium.CustomDataSource,this._viewer.dataSources.add(this._layer),this._handler=new Cesium.ScreenSpaceEventHandler(this._viewer.canvas),this._pointer=!1,this._viewer.scene.globe.depthTestAgainstTerrain=!0};c.prototype.setIsMeasure=function(e){this._isMeasure=e},c.prototype.setIsClampGround=function(e){this._isClampGround=e},c.prototype.startPoint=function(){var i=this;s=!0;this._handler.setInputAction(function(t){if(s){var c=function(){var c=i._viewer.scene.globe.pick(i._viewer.scene.camera.getPickRay(new Cesium.Cartesian2(t.position.x,t.position.y)),i._viewer.scene);if(!i._isMeasure)return{v:i._layer.entities.add({position:new Cesium.CallbackProperty(function(){return c},!1),point:{pixelSize:10,color:e,heightReference:i._isClampGround?Cesium.HeightReference.CLAMP_TO_GROUND:Cesium.HeightReference.NONE}})};!function(){var t=Cesium.Cartographic.fromCartesian(c),C=Cesium.Math.toDegrees(t.longitude).toFixed(2),p=Cesium.Math.toDegrees(t.latitude).toFixed(2);Cesium.sampleTerrain(i._viewer.terrainProvider,9,[t]).then(function(t){var d=t[0].height>1e3?(t[0].height/1e3).toFixed(2)+"km":t[0].height.toFixed(2)+"m ";return i._layer.entities.add({position:new Cesium.CallbackProperty(function(){return c},!0),point:{pixelSize:10,color:e,heightReference:i._isClampGround?Cesium.HeightReference.CLAMP_TO_GROUND:Cesium.HeightReference.NONE},label:{text:"经度: "+("        "+C).slice(-9)+"°\n纬度: "+("        "+p).slice(-9)+"°\n高度："+("        "+d).slice(-9)+"  ",font:o,fillColor:n,outlineColor:Cesium.Color.BLACK,outlineWidth:2,style:Cesium.LabelStyle.FILL_AND_OUTLINE,showBackground:!0,horizontalOrigin:r,verticalOrigin:Cesium.VerticalOrigin.BOTTOM,heightReference:i._isClampGround?Cesium.HeightReference.CLAMP_TO_GROUND:Cesium.HeightReference.NONE,disableDepthTestDistance:new Cesium.CallbackProperty(function(){return u||l||a||s?0:Number.POSITIVE_INFINITY},!1)}})})}()}();if("object"===(void 0===c?"undefined":_typeof(c)))return c.v}},Cesium.ScreenSpaceEventType.LEFT_CLICK)},c.prototype.startModelPoint=function(){var i=this;s=!0;this._handler.setInputAction(function(t){if(s){var c=function(){var c=i._viewer.scene.pickPosition(t.position);if(!Cesium.defined(c)||!Cesium.defined(i._viewer.scene.pick(t.position)))return{v:void 0};if(!i._isMeasure)return{v:i._layer.entities.add({position:new Cesium.CallbackProperty(function(){return c},!0),point:{pixelSize:10,color:e,heightReference:Cesium.HeightReference.NONE}})};var C=Cesium.Cartographic.fromCartesian(c),p=Cesium.Math.toDegrees(C.longitude).toFixed(2),d=Cesium.Math.toDegrees(C.latitude).toFixed(2),m=C.height>1e3?(C.height/1e3).toFixed(2)+"km":C.height.toFixed(2)+"m ";i._layer.entities.add({position:new Cesium.CallbackProperty(function(){return c},!0),point:{pixelSize:10,color:e,heightReference:Cesium.HeightReference.NONE},label:{text:"经度: "+("        "+p).slice(-9)+"°\n纬度: "+("        "+d).slice(-9)+"°\n高度："+("        "+m).slice(-9)+"  ",font:o,fillColor:n,outlineColor:Cesium.Color.BLACK,outlineWidth:2,style:Cesium.LabelStyle.FILL_AND_OUTLINE,showBackground:!0,horizontalOrigin:r,verticalOrigin:Cesium.VerticalOrigin.BOTTOM,heightReference:Cesium.HeightReference.NONE,disableDepthTestDistance:new Cesium.CallbackProperty(function(){return u||l||a||s?0:Number.POSITIVE_INFINITY},!1)}})}();if("object"===(void 0===c?"undefined":_typeof(c)))return c.v}},Cesium.ScreenSpaceEventType.LEFT_CLICK)},c.prototype.stopPoint=function(){s=!1,this._handler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_CLICK)},c.prototype.startPolyline=function(){var t=this;this.stopPoint(),a=!0;var o=[],c=0,C=void 0;this._handler.setInputAction(function(i){a&&function(){o.pop();var n=t._viewer.scene.globe.pick(t._viewer.scene.camera.getPickRay(new Cesium.Cartesian2(i.position.x,i.position.y)),t._viewer.scene);o.push(n),t._layer.entities.add({position:new Cesium.CallbackProperty(function(){return n},!0),point:{pixelSize:10,color:e,heightReference:t._isClampGround?Cesium.HeightReference.CLAMP_TO_GROUND:Cesium.HeightReference.NONE}}),t._isMeasure&&o.length>1&&(t._isClampGround,c=p(o)),t._pointer=!1,C||(C=function(e){if(a&&o.length>0)if(t._pointer){o.pop();var i=t._viewer.scene.globe.pick(t._viewer.scene.camera.getPickRay(new Cesium.Cartesian2(e.endPosition.x,e.endPosition.y)),t._viewer.scene);o.push(i),t._isMeasure&&o.length>1&&(t._isClampGround,c=p(o))}else{var n=t._viewer.scene.globe.pick(t._viewer.scene.camera.getPickRay(new Cesium.Cartesian2(e.endPosition.x,e.endPosition.y)),t._viewer.scene);o.push(n),t._isMeasure&&o.length>1&&(t._isClampGround,c=p(o)),t._pointer=!0}},t._handler.setInputAction(C,Cesium.ScreenSpaceEventType.MOUSE_MOVE))}()},Cesium.ScreenSpaceEventType.LEFT_CLICK);this._handler.setInputAction(function(i){a&&function(){t._pointer=!1,t._handler.removeInputAction(Cesium.ScreenSpaceEventType.MOUSE_MOVE),o.pop();var n=t._viewer.scene.globe.pick(t._viewer.scene.camera.getPickRay(new Cesium.Cartesian2(i.position.x,i.position.y)),t._viewer.scene);o.push(n),t._layer.entities.add({position:new Cesium.CallbackProperty(function(){return n},!0),point:{pixelSize:10,color:e,heightReference:t._isClampGround?Cesium.HeightReference.CLAMP_TO_GROUND:Cesium.HeightReference.NONE}}),t._isMeasure&&o.length>1&&(t._isClampGround,c=p(o)),t.stopPolyline()}()},Cesium.ScreenSpaceEventType.RIGHT_CLICK),this._isMeasure?this._isClampGround?this._layer.entities.add({position:new Cesium.CallbackProperty(function(){return o[o.length-1]},!1),corridor:{positions:new Cesium.CallbackProperty(function(){return o},!1),width:this._lineWidth,material:i},label:{text:new Cesium.CallbackProperty(function(){return c>1e3?(c/1e3).toFixed(2).toString()+"km":c.toFixed(2).toString()+"m"},!1),font:"15px Helvetica",fillColor:n,outlineColor:Cesium.Color.BLACK,outlineWidth:2,style:Cesium.LabelStyle.FILL_AND_OUTLINE,showBackground:!0,horizontalOrigin:r,verticalOrigin:Cesium.VerticalOrigin.BOTTOM,heightReference:this._isClampGround?Cesium.HeightReference.CLAMP_TO_GROUND:Cesium.HeightReference.NONE,disableDepthTestDistance:new Cesium.CallbackProperty(function(){return u||l||a||s?0:Number.POSITIVE_INFINITY},!1)}}):this._layer.entities.add({position:new Cesium.CallbackProperty(function(){return o[o.length-1]},!1),polyline:{positions:new Cesium.CallbackProperty(function(){return o},!1),width:this._lineWidth,material:i},label:{text:new Cesium.CallbackProperty(function(){return c>1e3?(c/1e3).toFixed(2).toString()+"km":c.toFixed(2).toString()+"m"},!1),font:"15px Helvetica",fillColor:n,outlineColor:Cesium.Color.BLACK,outlineWidth:2,style:Cesium.LabelStyle.FILL_AND_OUTLINE,showBackground:!0,horizontalOrigin:r,verticalOrigin:Cesium.VerticalOrigin.BOTTOM}}):this._isClampGround?this._layer.entities.add({corridor:{positions:new Cesium.CallbackProperty(function(){return o},!1),width:this._lineWidth,material:i}}):this._layer.entities.add({polyline:{positions:new Cesium.CallbackProperty(function(){return o},!1),width:this._lineWidth,material:i}})},c.prototype.startModelPolyline=function(){var t=this;this.stopPoint(),a=!0;var c=[],C=0,d=void 0;this._handler.setInputAction(function(i){if(a){var n=function(){var n=t._viewer.scene.pickPosition(i.position);if(!Cesium.defined(n)||!Cesium.defined(t._viewer.scene.pick(i.position)))return{v:void 0};c.pop(),c.push(n),t._layer.entities.add({position:new Cesium.CallbackProperty(function(){return n},!0),point:{pixelSize:10,color:e,heightReference:Cesium.HeightReference.NONE}}),t._isMeasure&&c.length>1&&(C=p(c)),t._pointer=!1,d||(d=function(e){if(a&&c.length>0)if(t._pointer){var i=t._viewer.scene.pickPosition(e.endPosition);if(!Cesium.defined(i)||!Cesium.defined(t._viewer.scene.pick(e.endPosition)))return;c.pop(),c.push(i),t._isMeasure&&c.length>1&&(C=p(c))}else{var n=t._viewer.scene.pickPosition(e.endPosition);if(!Cesium.defined(n)||!Cesium.defined(t._viewer.scene.pick(e.endPosition)))return;c.push(n),t._isMeasure&&c.length>1&&(C=p(c)),t._pointer=!0}},t._handler.setInputAction(d,Cesium.ScreenSpaceEventType.MOUSE_MOVE))}();if("object"===(void 0===n?"undefined":_typeof(n)))return n.v}},Cesium.ScreenSpaceEventType.LEFT_CLICK);if(this._handler.setInputAction(function(i){if(a){var n=function(){var n=t._viewer.scene.pickPosition(i.position);if(!Cesium.defined(n)||!Cesium.defined(t._viewer.scene.pick(i.position)))return{v:void 0};t._pointer=!1,t._handler.removeInputAction(Cesium.ScreenSpaceEventType.MOUSE_MOVE),c.pop(),c.push(n),t._layer.entities.add({position:new Cesium.CallbackProperty(function(){return n},!0),point:{pixelSize:10,color:e,heightReference:Cesium.HeightReference.NONE}}),t._isMeasure&&c.length>1&&(t._isClampGround,C=p(c)),t.stopPolyline()}();if("object"===(void 0===n?"undefined":_typeof(n)))return n.v}},Cesium.ScreenSpaceEventType.RIGHT_CLICK),this._isMeasure)return this._layer.entities.add({position:new Cesium.CallbackProperty(function(){return c[c.length-1]},!1),polyline:{positions:new Cesium.CallbackProperty(function(){return c},!1),width:this._lineWidth,material:i},label:{text:new Cesium.CallbackProperty(function(){return C>1e3?(C/1e3).toFixed(2).toString()+"km":C.toFixed(2).toString()+"m"},!1),font:o,fillColor:n,outlineColor:Cesium.Color.BLACK,outlineWidth:2,style:Cesium.LabelStyle.FILL_AND_OUTLINE,showBackground:!0,horizontalOrigin:r,verticalOrigin:Cesium.VerticalOrigin.BOTTOM,disableDepthTestDistance:new Cesium.CallbackProperty(function(){return u||l||a||s?0:Number.POSITIVE_INFINITY},!1)}});this._layer.entities.add({polyline:{positions:new Cesium.CallbackProperty(function(){return c},!1),width:this._lineWidth,material:i}})},c.prototype.stopPolyline=function(){a=!1,this._handler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_CLICK),this._handler.removeInputAction(Cesium.ScreenSpaceEventType.RIGHT_CLICK)},c.prototype.startPolygon=function(){var c=this;this.stopPoint(),l=!0;var p=[],d=0,m=void 0;this._handler.setInputAction(function(i){l&&function(){p.pop();var t=c._viewer.scene.globe.pick(c._viewer.scene.camera.getPickRay(new Cesium.Cartesian2(i.position.x,i.position.y)),c._viewer.scene);p.push(t),c._layer.entities.add({position:new Cesium.CallbackProperty(function(){return t},!0),point:{pixelSize:10,color:e,heightReference:c._isClampGround?Cesium.HeightReference.CLAMP_TO_GROUND:Cesium.HeightReference.NONE}}),c._isMeasure&&p.length>2&&(d=C(p,c._viewer)),c._pointer=!1,m||(m=function(e){if(l&&p.length>0)if(c._pointer){p.pop();var i=c._viewer.scene.globe.pick(c._viewer.scene.camera.getPickRay(new Cesium.Cartesian2(e.endPosition.x,e.endPosition.y)),c._viewer.scene);p.push(i),c._isMeasure&&p.length>2&&(d=C(p,c._viewer))}else{var t=c._viewer.scene.globe.pick(c._viewer.scene.camera.getPickRay(new Cesium.Cartesian2(e.endPosition.x,e.endPosition.y)),c._viewer.scene);p.push(t),c._isMeasure&&p.length>2&&(d=C(p,c._viewer)),c._pointer=!0}},c._handler.setInputAction(m,Cesium.ScreenSpaceEventType.MOUSE_MOVE))}()},Cesium.ScreenSpaceEventType.LEFT_CLICK);this._handler.setInputAction(function(i){l&&function(){c._pointer=!1,c._handler.removeInputAction(Cesium.ScreenSpaceEventType.MOUSE_MOVE),p.pop();var t=c._viewer.scene.globe.pick(c._viewer.scene.camera.getPickRay(new Cesium.Cartesian2(i.position.x,i.position.y)),c._viewer.scene);p.push(t),c._layer.entities.add({position:new Cesium.CallbackProperty(function(){return t},!0),point:{pixelSize:10,color:e,heightReference:c._isClampGround?Cesium.HeightReference.CLAMP_TO_GROUND:Cesium.HeightReference.NONE}}),c._isMeasure&&p.length>2&&(d=C(p,c._viewer)),p.push(p[0]),c.stopPolygon()}()},Cesium.ScreenSpaceEventType.RIGHT_CLICK),this._isMeasure?this._isClampGround?this._layer.entities.add({position:new Cesium.CallbackProperty(function(){return p[p.length-1]},!1),polygon:{hierarchy:new Cesium.CallbackProperty(function(){return p},!1),material:t,perPositionHeight:!this._isClampGround},corridor:{positions:new Cesium.CallbackProperty(function(){return p},!1),width:this._lineWidth,material:i},label:{text:new Cesium.CallbackProperty(function(){return d>1e6?(d/1e6).toFixed(2).toString()+"平方公里":d.toFixed(2).toString()+"平方米"},!1),font:o,fillColor:n,outlineColor:Cesium.Color.BLACK,outlineWidth:2,style:Cesium.LabelStyle.FILL_AND_OUTLINE,showBackground:!0,horizontalOrigin:r,verticalOrigin:Cesium.VerticalOrigin.BOTTOM,heightReference:this._isClampGround?Cesium.HeightReference.CLAMP_TO_GROUND:Cesium.HeightReference.NONE,disableDepthTestDistance:new Cesium.CallbackProperty(function(){return u||l||a||s?0:Number.POSITIVE_INFINITY},!1)}}):this._layer.entities.add({position:new Cesium.CallbackProperty(function(){return p[p.length-1]},!1),polygon:{hierarchy:new Cesium.CallbackProperty(function(){return p},!1),material:t,perPositionHeight:!this._isClampGround},polyline:{positions:new Cesium.CallbackProperty(function(){return p},!1),width:this._lineWidth,material:i,followSurface:!this._isClampGround},label:{text:new Cesium.CallbackProperty(function(){return d>1e6?(d/1e6).toFixed(2).toString()+"平方公里":d.toFixed(2).toString()+"平方米"},!1),font:o,fillColor:n,outlineColor:Cesium.Color.BLACK,outlineWidth:2,style:Cesium.LabelStyle.FILL_AND_OUTLINE,showBackground:!0,horizontalOrigin:r,verticalOrigin:Cesium.VerticalOrigin.BOTTOM,heightReference:this._isClampGround?Cesium.HeightReference.CLAMP_TO_GROUND:Cesium.HeightReference.NONE,disableDepthTestDistance:new Cesium.CallbackProperty(function(){return u||l||a||s?0:Number.POSITIVE_INFINITY},!1)}}):this._layer.entities.add({position:new Cesium.CallbackProperty(function(){return p[p.length-1]},!1),polygon:{hierarchy:new Cesium.CallbackProperty(function(){return p},!1),material:t,perPositionHeight:!this._isClampGround}})},c.prototype.startModelPolygon=function(){var c=this;this.stopPoint(),l=!0;var p=[],d=0,m=void 0;this._handler.setInputAction(function(i){if(l){var t=function(){var t=c._viewer.scene.pickPosition(i.position);if(!Cesium.defined(t)||!Cesium.defined(c._viewer.scene.pick(i.position)))return{v:void 0};p.pop(),p.push(t),c._layer.entities.add({position:new Cesium.CallbackProperty(function(){return t},!0),point:{pixelSize:10,color:e,heightReference:Cesium.HeightReference.NONE}}),c._isMeasure&&p.length>2&&(d=C(p,c._viewer)),c._pointer=!1,m||(m=function(e){if(l&&p.length>0)if(c._pointer){var i=c._viewer.scene.pickPosition(e.endPosition);if(!Cesium.defined(i)||!Cesium.defined(c._viewer.scene.pick(e.endPosition)))return;p.pop(),p.push(i),c._isMeasure&&p.length>2&&(d=C(p,c._viewer))}else{var t=c._viewer.scene.pickPosition(e.endPosition);if(!Cesium.defined(t)||!Cesium.defined(c._viewer.scene.pick(e.endPosition)))return;p.push(t),c._isMeasure&&p.length>2&&(d=C(p,c._viewer)),c._pointer=!0}},c._handler.setInputAction(m,Cesium.ScreenSpaceEventType.MOUSE_MOVE))}();if("object"===(void 0===t?"undefined":_typeof(t)))return t.v}},Cesium.ScreenSpaceEventType.LEFT_CLICK);this._handler.setInputAction(function(i){if(l){var t=function(){var t=c._viewer.scene.pickPosition(i.position);if(!Cesium.defined(t)||!Cesium.defined(c._viewer.scene.pick(i.position)))return{v:void 0};c._pointer=!1,c._handler.removeInputAction(Cesium.ScreenSpaceEventType.MOUSE_MOVE),p.pop(),p.push(t),c._layer.entities.add({position:new Cesium.CallbackProperty(function(){return t},!0),point:{pixelSize:10,color:e,heightReference:Cesium.HeightReference.NONE}}),c._isMeasure&&p.length>2&&(d=C(p,c._viewer)),p.push(p[0]),c.stopPolygon()}();if("object"===(void 0===t?"undefined":_typeof(t)))return t.v}},Cesium.ScreenSpaceEventType.RIGHT_CLICK),this._isMeasure?this._layer.entities.add({position:new Cesium.CallbackProperty(function(){return p[p.length-1]},!1),polygon:{hierarchy:new Cesium.CallbackProperty(function(){return p},!1),material:t,perPositionHeight:!0},polyline:{positions:new Cesium.CallbackProperty(function(){return p},!1),width:this._lineWidth,material:i,followSurface:!this._isClampGround},label:{text:new Cesium.CallbackProperty(function(){return d>1e6?(d/1e6).toFixed(2).toString()+"平方公里":d.toFixed(2).toString()+"平方米"},!1),font:o,fillColor:n,outlineColor:Cesium.Color.BLACK,outlineWidth:2,style:Cesium.LabelStyle.FILL_AND_OUTLINE,showBackground:!0,horizontalOrigin:r,verticalOrigin:Cesium.VerticalOrigin.BOTTOM,disableDepthTestDistance:new Cesium.CallbackProperty(function(){return u||l||a||s?0:Number.POSITIVE_INFINITY},!1)}}):this._layer.entities.add({position:new Cesium.CallbackProperty(function(){return p[p.length-1]},!1),polygon:{hierarchy:new Cesium.CallbackProperty(function(){return p},!1),material:t,perPositionHeight:!0}})},c.prototype.stopPolygon=function(){l=!1,this._handler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_CLICK),this._handler.removeInputAction(Cesium.ScreenSpaceEventType.RIGHT_CLICK)},c.prototype.startElevation=function(){var t=this;this.stopPoint(),u=!0;var r=void 0,c=void 0,C=void 0,p=void 0,d=void 0,m=void 0,h=void 0,_=0,f=0,g=0,y=!1,v=!1;this._handler.setInputAction(function(i){u&&(v?function(){t._handler.removeInputAction(Cesium.ScreenSpaceEventType.MOUSE_MOVE);var n=t._viewer.scene.globe.pick(t._viewer.scene.camera.getPickRay(new Cesium.Cartesian2(i.position.x,i.position.y)),t._viewer.scene);d=t._viewer.scene.globe.ellipsoid.cartesianToCartographic(n),p.height>d.height?(m=new Cesium.Cartographic(d.longitude,d.latitude,p.height),C=t._viewer.scene.globe.ellipsoid.cartographicToCartesian(m),f=Cesium.Cartesian3.distance(r,C),f=g>1e3?(f/1e3).toFixed(2).toString()+"km":f.toFixed(2).toString()+"m",_=Cesium.Cartesian3.distance(n,C),_=g>1e3?(_/1e3).toFixed(2).toString()+"km":_.toFixed(2).toString()+"m",y=!0):(m=new Cesium.Cartographic(p.longitude,p.latitude,d.height),C=t._viewer.scene.globe.ellipsoid.cartographicToCartesian(m),_=Cesium.Cartesian3.distance(r,C),_=g>1e3?(_/1e3).toFixed(2).toString()+"km":_.toFixed(2).toString()+"m",f=Cesium.Cartesian3.distance(n,C),f=g>1e3?(f/1e3).toFixed(2).toString()+"km":f.toFixed(2).toString()+"m",y=!1),t._layer.entities.add({position:new Cesium.CallbackProperty(function(){return C},!0),point:{pixelSize:10,color:e,heightReference:t._isClampGround?Cesium.HeightReference.CLAMP_TO_GROUND:Cesium.HeightReference.NONE}}),t._layer.entities.add({position:new Cesium.CallbackProperty(function(){return n},!0),point:{pixelSize:10,color:e,heightReference:t._isClampGround?Cesium.HeightReference.CLAMP_TO_GROUND:Cesium.HeightReference.NONE}}),g=(g=Cesium.Cartesian3.distance(r,n))>1e3?(g/1e3).toFixed(2).toString()+"km":g.toFixed(2).toString()+"m",t.stopElevation()}():(r=t._viewer.scene.globe.pick(t._viewer.scene.camera.getPickRay(new Cesium.Cartesian2(i.position.x,i.position.y)),t._viewer.scene),p=t._viewer.scene.globe.ellipsoid.cartesianToCartographic(r),v=!0,t._layer.entities.add({position:new Cesium.CallbackProperty(function(){return r},!0),point:{pixelSize:10,color:e,heightReference:t._isClampGround?Cesium.HeightReference.CLAMP_TO_GROUND:Cesium.HeightReference.NONE}}),h=function(e){c=t._viewer.scene.globe.pick(t._viewer.scene.camera.getPickRay(new Cesium.Cartesian2(e.endPosition.x,e.endPosition.y)),t._viewer.scene),d=t._viewer.scene.globe.ellipsoid.cartesianToCartographic(c),p.height>d.height?(m=new Cesium.Cartographic(d.longitude,d.latitude,p.height),C=t._viewer.scene.globe.ellipsoid.cartographicToCartesian(m),f=Cesium.Cartesian3.distance(r,C),f=g>1e3?(f/1e3).toFixed(2).toString()+"km":f.toFixed(2).toString()+"m",_=Cesium.Cartesian3.distance(c,C),_=g>1e3?(_/1e3).toFixed(2).toString()+"km":_.toFixed(2).toString()+"m",y=!0):(m=new Cesium.Cartographic(p.longitude,p.latitude,d.height),C=t._viewer.scene.globe.ellipsoid.cartographicToCartesian(m),_=Cesium.Cartesian3.distance(r,C),_=g>1e3?(_/1e3).toFixed(2).toString()+"km":_.toFixed(2).toString()+"m",f=Cesium.Cartesian3.distance(c,C),f=g>1e3?(f/1e3).toFixed(2).toString()+"km":f.toFixed(2).toString()+"m",y=!1),g=(g=Cesium.Cartesian3.distance(r,c))>1e3?(g/1e3).toFixed(2).toString()+"km":g.toFixed(2).toString()+"m"},t._handler.setInputAction(h,Cesium.ScreenSpaceEventType.MOUSE_MOVE)))},Cesium.ScreenSpaceEventType.LEFT_CLICK),this._layer.entities.add({position:new Cesium.CallbackProperty(function(){return r&&c?Cesium.Cartesian3.lerp(r,c,.5,new Cesium.Cartesian3):void 0},!1),polyline:{positions:new Cesium.CallbackProperty(function(){return r&&c?[r,c]:[]},!1),width:this._lineWidth,material:i},label:{text:new Cesium.CallbackProperty(function(){return"空间距离："+g},!1),font:o,fillColor:n,outlineColor:Cesium.Color.BLACK,outlineWidth:2,style:Cesium.LabelStyle.FILL_AND_OUTLINE,showBackground:!0,horizontalOrigin:Cesium.HorizontalOrigin.CENTER,verticalOrigin:Cesium.VerticalOrigin.TOP,disableDepthTestDistance:new Cesium.CallbackProperty(function(){return u||l||a||s?0:Number.POSITIVE_INFINITY},!1)}}),this._layer.entities.add({position:new Cesium.CallbackProperty(function(){return r&&C?Cesium.Cartesian3.lerp(r,C,.5,new Cesium.Cartesian3):void 0},!1),polyline:{positions:new Cesium.CallbackProperty(function(){return r&&C?[r,C]:[]},!1),width:this._lineWidth,material:i},label:{text:new Cesium.CallbackProperty(function(){return y?"水平距离："+f:"垂直距离："+_},!1),font:o,fillColor:n,outlineColor:Cesium.Color.BLACK,outlineWidth:2,style:Cesium.LabelStyle.FILL_AND_OUTLINE,showBackground:!0,horizontalOrigin:Cesium.HorizontalOrigin.CENTER,verticalOrigin:Cesium.VerticalOrigin.BOTTOM,disableDepthTestDistance:new Cesium.CallbackProperty(function(){return u||l||a||s?0:Number.POSITIVE_INFINITY},!1)}}),this._layer.entities.add({position:new Cesium.CallbackProperty(function(){return c&&C?Cesium.Cartesian3.lerp(c,C,.5,new Cesium.Cartesian3):void 0},!1),polyline:{positions:new Cesium.CallbackProperty(function(){return C&&c?[C,c]:[]},!1),width:this._lineWidth,material:i},label:{text:new Cesium.CallbackProperty(function(){return y?"垂直距离："+_:"水平距离："+f},!1),font:o,fillColor:n,outlineColor:Cesium.Color.BLACK,outlineWidth:2,style:Cesium.LabelStyle.FILL_AND_OUTLINE,showBackground:!0,horizontalOrigin:Cesium.HorizontalOrigin.CENTER,verticalOrigin:Cesium.VerticalOrigin.BOTTOM,disableDepthTestDistance:new Cesium.CallbackProperty(function(){return u||l||a||s?0:Number.POSITIVE_INFINITY},!1)}})},c.prototype.startModelElevation=function(){var t=this;this.stopPoint(),u=!0;var r=void 0,c=void 0,C=void 0,p=void 0,d=void 0,m=void 0,h=0,_=0,f=0,g=!1,y=!1;this._handler.setInputAction(function(i){if(u)if(y){var n=function(){var n=t._viewer.scene.pickPosition(i.position);if(!Cesium.defined(n)||!Cesium.defined(t._viewer.scene.pick(i.position)))return{v:void 0};t._handler.removeInputAction(Cesium.ScreenSpaceEventType.MOUSE_MOVE),d=Cesium.Cartographic.fromCartesian(n),p.height>d.height?(C=Cesium.Cartesian3.fromRadians(d.longitude,d.latitude,p.height),_=Cesium.Cartesian3.distance(r,C),_=f>1e3?(_/1e3).toFixed(2).toString()+"km":_.toFixed(2).toString()+"m",h=Cesium.Cartesian3.distance(n,C),h=f>1e3?(h/1e3).toFixed(2).toString()+"km":h.toFixed(2).toString()+"m",g=!0):(C=Cesium.Cartesian3.fromRadians(p.longitude,p.latitude,d.height),h=Cesium.Cartesian3.distance(r,C),h=f>1e3?(h/1e3).toFixed(2).toString()+"km":h.toFixed(2).toString()+"m",_=Cesium.Cartesian3.distance(n,C),_=f>1e3?(_/1e3).toFixed(2).toString()+"km":_.toFixed(2).toString()+"m",g=!1),t._layer.entities.add({position:new Cesium.CallbackProperty(function(){return C},!0),point:{pixelSize:10,color:e,heightReference:Cesium.HeightReference.NONE}}),t._layer.entities.add({position:new Cesium.CallbackProperty(function(){return n},!0),point:{pixelSize:10,color:e,heightReference:Cesium.HeightReference.NONE}}),f=(f=Cesium.Cartesian3.distance(r,n))>1e3?(f/1e3).toFixed(2).toString()+"km":f.toFixed(2).toString()+"m",t.stopElevation()}();if("object"===(void 0===n?"undefined":_typeof(n)))return n.v}else{if(r=t._viewer.scene.pickPosition(i.position),!Cesium.defined(r)||!Cesium.defined(t._viewer.scene.pick(i.position)))return;p=Cesium.Cartographic.fromCartesian(r),y=!0,t._layer.entities.add({position:new Cesium.CallbackProperty(function(){return r},!0),point:{pixelSize:10,color:e,heightReference:Cesium.HeightReference.NONE}}),m=function(e){c=t._viewer.scene.pickPosition(e.endPosition),Cesium.defined(c)&&Cesium.defined(t._viewer.scene.pick(e.endPosition))&&(d=Cesium.Cartographic.fromCartesian(c),p.height>d.height?(C=Cesium.Cartesian3.fromRadians(d.longitude,d.latitude,p.height),_=Cesium.Cartesian3.distance(r,C),_=f>1e3?(_/1e3).toFixed(2).toString()+"km":_.toFixed(2).toString()+"m",h=Cesium.Cartesian3.distance(c,C),h=f>1e3?(h/1e3).toFixed(2).toString()+"km":h.toFixed(2).toString()+"m",g=!0):(C=Cesium.Cartesian3.fromRadians(p.longitude,p.latitude,d.height),h=Cesium.Cartesian3.distance(r,C),h=f>1e3?(h/1e3).toFixed(2).toString()+"km":h.toFixed(2).toString()+"m",_=Cesium.Cartesian3.distance(c,C),_=f>1e3?(_/1e3).toFixed(2).toString()+"km":_.toFixed(2).toString()+"m",g=!1),f=(f=Cesium.Cartesian3.distance(r,c))>1e3?(f/1e3).toFixed(2).toString()+"km":f.toFixed(2).toString()+"m")},t._handler.setInputAction(m,Cesium.ScreenSpaceEventType.MOUSE_MOVE)}},Cesium.ScreenSpaceEventType.LEFT_CLICK),this._layer.entities.add({position:new Cesium.CallbackProperty(function(){return r&&c?Cesium.Cartesian3.lerp(r,c,.5,new Cesium.Cartesian3):void 0},!1),polyline:{positions:new Cesium.CallbackProperty(function(){return r&&c?[r,c]:[]},!1),width:this._lineWidth,material:i},label:{text:new Cesium.CallbackProperty(function(){return"空间距离："+f},!1),font:o,fillColor:n,outlineColor:Cesium.Color.BLACK,outlineWidth:2,style:Cesium.LabelStyle.FILL_AND_OUTLINE,showBackground:!0,horizontalOrigin:Cesium.HorizontalOrigin.CENTER,verticalOrigin:Cesium.VerticalOrigin.TOP,disableDepthTestDistance:new Cesium.CallbackProperty(function(){return u||l||a||s?0:Number.POSITIVE_INFINITY},!1)}}),this._layer.entities.add({position:new Cesium.CallbackProperty(function(){return r&&C?Cesium.Cartesian3.lerp(r,C,.5,new Cesium.Cartesian3):void 0},!1),polyline:{positions:new Cesium.CallbackProperty(function(){return r&&C?[r,C]:[]},!1),width:this._lineWidth,material:i},label:{text:new Cesium.CallbackProperty(function(){return g?"水平距离："+_:"垂直距离："+h},!1),font:o,fillColor:n,outlineColor:Cesium.Color.BLACK,outlineWidth:2,style:Cesium.LabelStyle.FILL_AND_OUTLINE,showBackground:!0,horizontalOrigin:Cesium.HorizontalOrigin.CENTER,verticalOrigin:Cesium.VerticalOrigin.BOTTOM,disableDepthTestDistance:new Cesium.CallbackProperty(function(){return u||l||a||s?0:Number.POSITIVE_INFINITY},!1)}}),this._layer.entities.add({position:new Cesium.CallbackProperty(function(){return c&&C?Cesium.Cartesian3.lerp(c,C,.5,new Cesium.Cartesian3):void 0},!1),polyline:{positions:new Cesium.CallbackProperty(function(){return C&&c?[C,c]:[]},!1),width:this._lineWidth,material:i},label:{text:new Cesium.CallbackProperty(function(){return g?"垂直距离："+h:"水平距离："+_},!1),font:o,fillColor:n,outlineColor:Cesium.Color.BLACK,outlineWidth:2,style:Cesium.LabelStyle.FILL_AND_OUTLINE,showBackground:!0,horizontalOrigin:Cesium.HorizontalOrigin.CENTER,verticalOrigin:Cesium.VerticalOrigin.BOTTOM,disableDepthTestDistance:new Cesium.CallbackProperty(function(){return u||l||a||s?0:Number.POSITIVE_INFINITY},!1)}})},c.prototype.stopElevation=function(){u=!1,this._handler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_CLICK),this._handler.removeInputAction(Cesium.ScreenSpaceEventType.RIGHT_CLICK)},c.prototype.destory=function(){this.stopPoint(),this.stopPolyline(),this.stopPolygon(),this.stopElevation(),this._layer.entities.removeAll()};function C(e,i){var t=e.length,n=0,r=void 0,o=void 0;if(t>2){for(var s=0;s<t;s++){r=e[s],o=e[(s+1)%t];var a=i.scene.globe.ellipsoid,l=new Cesium.Cartesian3(r.x,r.y,r.z),u=a.cartesianToCartographic(l),c=new Cesium.Cartesian3(o.x,o.y,o.z),C=a.cartesianToCartographic(c);n+=(C.longitude-u.longitude)*(2+Math.sin(u.latitude)+Math.sin(C.latitude))}n=6378137*n*6378137/2}return Math.abs(n)}function p(e){for(var i=0,t=0;t<e.length-1;t++)i+=Cesium.Cartesian3.distance(e[t],e[t+1]);return i}Cesium.DrawTool=c}();
